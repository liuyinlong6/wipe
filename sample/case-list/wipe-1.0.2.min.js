/*!wipe-lyl 1.0.2 发布日期:2018-11-14*/
var cas=document.getElementById("cas"),context=cas.getContext("2d"),_w=cas.width,_h=cas.height,x=0,y=0,t=0,radius=20,isMouseDown=!1,device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());console.log(device);var eventdown=device?"touchstart":"mousedown",eventMover=device?"touchmove":"mousemove",eventEnd=device?"touchend":"mouseup";function drawMask(e){e.fillStyle="#666",e.fillRect(0,0,_w,_h),e.globalCompositeOperation="destination-out"}function optimize(e,t,n,o,i){e.save(),e.beginPath(),arguments.length<4?(e.arc(t,n,radius,0,2*Math.PI),e.fillStyle="red",e.fill()):(e.lineCap="round",e.moveTo(t,n),e.lineTo(o,i),e.lineWidth=2*radius,e.stroke()),e.restore()}function fn1(e){if(!0===isMouseDown){var t=e||window.event;t.preventDefault();var n=device?t.touches[0].clientX:t.clientX,o=device?t.touches[0].clientY:t.clientY;optimize(context,x,y,n,o),x=n,y=o}}function clearRect(e){e.clearRect(0,0,_w,_h)}function getTransparencyPercent(e){for(var n=e.getImageData(0,0,_w,_h),o=0;o<n.data.length;o+=4){0===n.data[o+3]&&t++}return(t/(_w*_h)*100).toFixed(2)}cas.addEventListener(eventdown,function(e){isMouseDown=!0;var t=e||window.event;x=device?t.touches[0].clientX:t.clientX,y=device?t.touches[0].clientY:t.clientY,optimize(context,x,y)},!1),cas.addEventListener(eventMover,fn1,!1),cas.addEventListener(eventEnd,function(){isMouseDown=!1,50<getTransparencyPercent(context)&&clearRect(context)},!1),window.onload=function(){drawMask(context)};